<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P4.2 Shaders - Albasel</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .series-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .series-info a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        .series-info a:hover {
            text-decoration: underline;
        }
        .series-progress {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .series-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
            gap: 1rem;
        }
        .nav-link {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.2s;
            max-width: 45%;
        }
        .nav-link:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        .nav-link-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        .nav-link-title {
            font-weight: bold;
            line-height: 1.3;
        }
        .nav-placeholder {
            width: 45%;
        }
        body.dark-mode .series-navigation {
            border-top: 2px solid #333;
        }
        body.dark-mode .nav-link {
            background: #2a2a2a;
            color: #e0e0e0;
        }
        body.dark-mode .nav-link:hover {
            background: #3a3a3a;
        }
        body.dark-mode .nav-link-label {
            color: #aaa;
        }
    </style>
</head>
<body>
    <nav class="navbar">
    <div class="navbar-container">
        <a href="/" class="navbar-title">Albasel</a>
        <ul class="navbar-links">
            <li><a href="/posts.html">Posts</a></li>
            <li><a href="/categories.html">Categories</a></li>
            <li><a href="/aboutme.html">About Me</a></li>
        </ul>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
            <i class="fa-solid fa-moon" id="theme-icon"></i>
        </button>
    </div>
</nav>

    <div class="container">
        <!-- Series Info (if post is part of a series) -->
        
        <div class="series-info">
            <div>
                <i class="fas fa-book"></i>
                <strong>Part 6 of 11</strong> in
                <a href="/computer-graphics---opengl/">Computer Graphics - OpenGL</a>
            </div>
            <div class="series-progress">
                6/11
            </div>
        </div>
        

        <!-- Post Content -->
        <article class="post">
            <header class="post-header">
                <h1>P4.2 Shaders</h1>
                <div class="post-meta">
                    <time>2024-01-01</time>
                    <span class="category">OpenGL</span>
                    <span class="series-tag"><i class="fas fa-book"></i> Series</span>
                </div>
                
                <img src="/images/opengl.jpg" alt="P4.2 Shaders" class="post-image">
                
            </header>
            <div class="post-content">
                <h4>Writing our own Shader</h4>
<p>The plan is to create a function that takes <strong>vertexShader</strong>, <strong>fragmentShader</strong> source codes, compile them and provide a “<strong>program</strong>” that works as a shader for our triangle.</p>
<p>First let’s define a function that compiles shader string <strong>( we will basically write code in a string that opengl can later read it)</strong>.</p>
<pre><code class="language-c">static unsigned int CompileShader(unsigned int type, const std::string&amp; source) {
    // Create a shader object of the specified type
    unsigned int id = glCreateShader(type);

    // Get a pointer to the C string of the source code
    const char* src = source.c_str();

    // Provide the shader source code to OpenGL
    glShaderSource(id, 1, &amp;src, nullptr);

    // Compile the shader
    glCompileShader(id);

    // Check for compilation errors
    int result;
    glGetShaderiv(id, GL_COMPILE_STATUS, &amp;result);
    if (result == GL_FALSE) {
        // If there's an error, retrieve the error message
        int length;
        glGetShaderiv(id, GL_INFO_LOG_LENGTH, &amp;length);

        // Allocate memory on the stack for the error message
        char* message = (char*)alloca(length * sizeof(char));

        // Retrieve the error message
        glGetShaderInfoLog(id, length, &amp;length, message);

        // Print the error message
        std::cout &lt;&lt; &quot;Fail to Compile Shader: &quot; &lt;&lt; message &lt;&lt; std::endl;

        // Delete the shader as it's not needed anymore
        glDeleteShader(id);

        // Return 0 to indicate failure
        return 0;
    }

    // Return the ID of the successfully compiled shader
    return id;
}

</code></pre>
<ul>
<li><strong>Create Shader Object:</strong> unsigned int id = glCreateShader(type); creates a shader object of the specified type (<strong>GL_VERTEX_SHADER</strong> or <strong>GL_FRAGMENT_SHADER</strong>).</li>
</ul>
<p><img src="https://i.postimg.cc/fWm1rLS4/image.png" alt=""></p>
<hr>
<ul>
<li><strong>Provide Source Code:</strong> <code>const char* src = source.c_str();</code> gets a pointer to the C string of the shader source code provided as a parameter.</li>
</ul>
<hr>
<ul>
<li><strong>Set Shader Source:</strong> <code>glShaderSource(id, 1, &amp;src, nullptr);</code> provides the shader source code to OpenGL.</li>
</ul>
<p><img src="https://i.postimg.cc/fWm1rLS4/image.png" alt=""></p>
<hr>
<ul>
<li><strong>Compile Shader:</strong> <code>glCompileShader(id); </code>compiles the shader. glCompileShader compiles the source code strings that have been stored in the shader object specified by shader</li>
</ul>
<blockquote>
<p>The compilation status will be stored as part of the shader object’s state. This value will be set to GL_TRUE if the shader was compiled without errors and is ready for use, and GL_FALSE otherwise. It can be queried by calling glGetShader with arguments shader and GL_COMPILE_STATUS.</p>
</blockquote>
<p><img src="https://i.postimg.cc/KjWKTNPV/image.png" alt=""></p>
<hr>
<ul>
<li><strong>Check Compilation Status:</strong> <code>(id, GL_COMPILE_STATUS,  &amp;result); </code>checks if the compilation was successful.</li>
</ul>
<p><img src="https://i.postimg.cc/SNrSHVYp/image.png" alt=""></p>
<hr>
<ul>
<li><strong>Handle Compilation Errors:</strong> If there’s an error, the function retrieves and prints the error message using <code>glGetShaderInfoLog</code> and deallocates the shader object. The error message is printed to the console.</li>
</ul>
<p><img src="https://i.postimg.cc/SNrSHVYp/image.png" alt=""></p>
<hr>
<ul>
<li><strong>Return Shader ID:</strong> If the compilation is successful, it returns the ID of the compiled shader for later use.</li>
</ul>
<hr>
<p>The fundamental purpose of the <code>CreateShader</code> function is to perform a couple of tasks, but at its core, we need to supply OpenGL with the code text. Afterward, it links both components together and returns a unique identifier. This identifier allows us to bind the shader and use it, akin to how we generate a buffer that provides us with an ID, which we can then bind to access and utilize.</p>
<p>so the function takes two sources codes, sends them to compile function, then returns <code>Gluint</code> type shader that we can bind and use for our triangle.</p>
<pre><code class="language-c">static unsigned int CreateShader(const std::string&amp; vertexShader, const std::string&amp; fragmentShader) {
    // Create a shader program object
    unsigned int program = glCreateProgram();

    // Compile the vertex and fragment shaders
    unsigned int vs = CompileShader(GL_VERTEX_SHADER, vertexShader);
    unsigned int fs = CompileShader(GL_FRAGMENT_SHADER, fragmentShader);

    // Attach the compiled shaders to the program
    glAttachShader(program, vs);
    glAttachShader(program, fs);

    // Link the shaders into a program
    glLinkProgram(program);

    // Validate the program
    glValidateProgram(program);

    // Delete the individual shaders as they are now part of the program
    glDeleteShader(vs);
    glDeleteShader(fs);

    // Return the ID of the shader program
    return program;
}
</code></pre>
<ul>
<li><strong>Create Shader Program Object:</strong> <code>unsigned int program = glCreateProgram();</code> creates an empty program object and returns a non-zero value by which it can be referenced. A program object is an object to which shader objects can be attached. This provides a mechanism to specify the shader objects that will be linked to create a program.</li>
</ul>
<hr>
<ul>
<li><strong>Compile Shaders:</strong> The function calls <code>CompileShader</code> for both the vertex shader (<strong>GL_VERTEX_SHADER</strong>) and the fragment shader (<strong>GL_FRAGMENT_SHADER</strong>). The resulting shader IDs are stored in vs and fs.</li>
</ul>
<hr>
<ul>
<li><strong>Attach Shaders to Program:</strong> <code>glAttachShader(program, vs);</code> and <code>glAttachShader(program, fs)</code> attach the compiled vertex and fragment shaders to the shader program.
<img src="https://i.postimg.cc/m2bzcPQB/image.png" alt=""></li>
</ul>
<hr>
<ul>
<li><strong>Link Shaders:</strong> <code>glLinkProgram(program);</code> links the attached shaders into a complete shader program.</li>
</ul>
<hr>
<ul>
<li><strong>Validate Program:</strong> <code>glValidateProgram(program);</code> checks if the program can execute given the current OpenGL state. This step is optional but can be helpful for debugging.</li>
</ul>
<hr>
<ul>
<li><strong>Delete Individual Shaders:</strong> <code>glDeleteShader(vs);</code> and <code>glDeleteShader(fs);</code> delete the individual shaders now that they are attached to the program. This helps in freeing up resources.</li>
</ul>
<hr>
<ul>
<li><strong>Return Program ID:</strong> The function returns the ID of the created shader program.</li>
</ul>
<hr>
<p>These two shaders are example for creating a simple red color effect on the triangle, we don’t need to understand how it’s written now but it’s good to know</p>
<pre><code class="language-c">
        std::string vertexShader =
            &quot;#version 330 core&quot;
            &quot;\n&quot;
            &quot;layout(location = 0) in vec4 position;&quot;
            &quot;\n&quot;
            &quot;void main()\n&quot;
            &quot;{\n&quot;
            &quot;gl_Position = position;\n&quot;
            &quot;}\n&quot;;

        std::string fragmentShader =
            &quot;#version 330 core&quot;
            &quot;\n&quot;
            &quot;layout(location = 0) out vec4 color;&quot;
            &quot;\n&quot;
            &quot;void main()\n&quot;
            &quot;{\n&quot;
            &quot;color = vec4(1.0,0.0,0.0,1.0);\n&quot;
            &quot;}\n&quot;;
</code></pre>
<p>Next we will use files to make writing more efficient and cleaner.</p>

            </div>
            
            <!-- Series Navigation (if post is part of a series) -->
            
            <nav class="series-navigation">
                
                    <a href="/computer-graphics---opengl/P4.1 - Shaders.html" class="nav-link">
                        <span class="nav-link-label"><i class="fas fa-arrow-left"></i> Previous</span>
                        <span class="nav-link-title">P4.1 Shaders</span>
                    </a>
                
                
                
                    <a href="/computer-graphics---opengl/P4.3 - Shaders.html" class="nav-link" style="text-align: right;">
                        <span class="nav-link-label">Next <i class="fas fa-arrow-right"></i></span>
                        <span class="nav-link-title">P4.3 Shaders</span>
                    </a>
                
            </nav>
            
            
            <footer class="post-footer">
                
                    <a href="/computer-graphics---opengl/" class="back-link"><i class="fas fa-book"></i> Back to Computer Graphics - OpenGL</a>
                    <a href="/" class="back-link">&larr; Back to Home</a>
                
            </footer>
        </article>
    </div>
    
    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        function setTheme(mode) {
            document.body.classList.toggle('dark-mode', mode === 'dark');
            themeIcon.className = mode === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            localStorage.setItem('theme', mode);
        }
        toggleBtn.addEventListener('click', () => {
            const isDark = document.body.classList.toggle('dark-mode');
            themeIcon.className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') setTheme('dark');
    </script>
</body>
</html>